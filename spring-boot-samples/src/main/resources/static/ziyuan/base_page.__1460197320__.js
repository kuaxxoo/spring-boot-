GJ.add("app/ms_v2/common/base_page.js",["jquery","app/common/widget/widget.js"],function(b,a){var d=b("jquery");var c=b("app/common/widget/widget.js");a.initWidgets=c.initWidgets;a.initWidget=c.initWidget;a.ajaxWidget=function(i){var j=d(i.$el);var h=i.url;var k=c.template(d(i.template).html());var g=i.dataType||"json";var f=i.$target||j;d.get(h,function(l){if(l){if(d.isArray(l)){GJ.each(l,function(m){f.append(k(m))})}else{f.html(k(l))}if(i.showAfterDone){j.show()}}},g)};a.sideFloatWidget=c.define({events:{"click [data-role=backToTop]":"backToTop","click [data-role=small]":"open","click [data-role=close]":"onClose","click [data-role=wechatOpen]":"qrOpen","click [data-role=wechatClose]":"qrClose"},init:function(g){var f=this;this.categoryId=g.categoryId;this.config=g;this.check();d(window).on("resize",d.proxy(this.check,this)).on("scrollEvent",d.proxy(this.onScroll,this)).on("scroll",d.proxy(this.onScroll,this));setTimeout(function(){g.$el.addClass("backtotop-huodong-active")},4000);if(this.categoryId){this.categoryIdKey="categoryId_"+this.categoryId;GJ.use("js/util/storage/storage2.js",function(h){f.storage=new h("slideFloatWidget");var i=f.storage.get(f.categoryIdKey);if(i!==-1){f.open()}})}this.qrcode=this.config.$wechatQrcode;this.qrcode&&this.qrcode.data("shown",false);this.qrcodeClose=this.config.$wechatClose;this.wechatOpen=this.config.$wechatOpen;this.wechatOpen&&this.wechatOpen.show()},onClose:function(f){f.preventDefault();this.close();this.forbidShow()},forbidShow:function(){var g=new Date();var f=new Date(g.getFullYear(),g.getMonth(),g.getDate()+1).getTime();if(this.storage){var h=this.storage.get(this.categoryIdKey);if(h!==-1){this.storage.set(this.categoryIdKey,-1,f)}}},open:function(){this.config.$el.addClass("backtotop-active")},close:function(){this.config.$el.removeClass("backtotop-active");this.config.$el.removeClass("backtotop-huodong-active")},onScroll:function(){var g=this.config.$backToTop;var f=this.config.showBtnHeight||500;var h=document.documentElement.scrollTop||document.body.scrollTop;if(h>f&&!g.data("shown")){g.data("shown",true);g.css("display","block")}else{if(h<f&&g.data("shown")){g.data("shown",false);g.hide()}}},check:function(){if(GJ.getViewPort().width<1124){this.hide();return false}else{this.show();return true}},hide:function(){this.$el.hide()},show:function(){this.$el.show()},backToTop:function(g){g.preventDefault();var f=document.body.scrollTop?document.body:document.documentElement;if(f.scrollTop){d(f).animate({scrollTop:0},100)}},qrOpen:function(f){f.preventDefault();if(!this.qrcode.data("shown")){this.qrcode.show();this.qrcode.data("shown",true);this.qrcodeClose.show();this.wechatOpen.addClass("wechat-qr-hover");this.wechatOpen.removeClass("wechat-qr-none");this.wechatOpen.hide()}else{this.qrClose(f)}},qrClose:function(f){this.wechatOpen.show();f.preventDefault();this.qrcode.hide();this.qrcode.data("shown",false);this.qrcodeClose.hide();this.wechatOpen.removeClass("wechat-qr-hover");this.wechatOpen.addClass("wechat-qr-none")}});a.sideFloatWechatWidget=c.define({events:{"click [data-role=wechatOpen]":"onOpen","click [data-role=wechatClose]":"onClose"},init:function(f){},onOpen:function(){},onClose:function(){}});a.topScroller=function(f){var g=d(f.$el);if(GJ.getViewPort().width<1024){g.hide();return}var h=false;var i=500;if(document.body.scrollTop>i||document.documentElement.scrollTop>i){g.show()}g.click(function(){var j=document.body.scrollTop?document.body:document.documentElement;if(j.scrollTop){d(j).animate({scrollTop:0},100)}return false});d(window).on("scroll",function(){var j=document.documentElement.scrollTop||document.body.scrollTop;if(j>i&&!h){h=true;g.css("display","block")}if(!j&&h){h=false;g.hide()}})};a.feedBack=function(f){if(GJ.getViewPort().width>=1024){d(f.$el).show()}};a.hoverWidget=function(g){var h=d(g.$el);var k=h.find(".js-need-iframe-bg");var f=null;if(k.size()&&GJ.ua&&GJ.ua.ie===6){f=d("<iframe></iframe>");f.attr({border:0,frameSpacing:0,frameBorder:0,scrolling:"no"}).addClass("iframe-bg");var j=k.parent().css("position");var i=j==="relative"||j==="absolute";if(i){k.parent().prepend(f)}else{d("body").prepend(f)}}h.mouseenter(function(){if(g.$activeBlock){g.$activeBlock.addClass("active")}else{h.addClass("active")}if(f){var l={};if(i){l=k.position()}else{l=k.offset()}f.css({left:l.left,top:l.top,width:k.outerWidth(true),height:k.outerHeight(true)}).show()}}).mouseleave(function(){if(g.$activeBlock){g.$activeBlock.removeClass("active")}else{h.removeClass("active")}if(f){f.hide()}})};a.topNav=function(g){var h=d(g.$el);var f=h.find(".js-list");var i=h.find(".js-btn");var j=d("#header");GJ.use("log_tracker",function(){j.on("click","a",function(){GJ.LogTracker.trackEvent("/all@pos=top_guide@atype=click")})});i.mouseenter(function(){h.addClass("active")}).one("mouseenter",function(){GJ.use("app/ms_v2/template/top_nav.js",function(k){f.html(k);GJ.use("log_tracker",function(){GJ.LogTracker.bindAllTrackEvent()})})});h.mouseleave(function(){h.removeClass("active")})};a.initPlaceholders=function(){GJ.use(["jquery","js/util/jquery/plugin/placeholder/jquery.placeholder.js"],function(f){f(function(){f("[placeholder]").each(function(){f(this).placeholder()})})})};a.initWebIM=function(){if(window.location.search.indexOf("disablewebim=1")>-1){return false}GJ.use("tool/webim/js/webim.js")};a.initLogTracker=function(f){f=f||window.PAGE_CONFIG.logTracker||{};GJ.use("log_tracker",function(){if(f.gjch){GJ.LogTracker.gjch=f.gjch}if(f.gjchver){GJ.LogTracker.gjchver=f.gjchver}if(f.reqid){GJ.LogTracker.reqid=f.reqid}if(f.gjchNew){GJ.LogTracker.gjchNew=f.gjchNew}if(f.server){GJ.LogTracker.server=f.server}GJ.LogTracker.bindSpeedEvent();a.initEventLog(f);a.sendPageViewLog(f);a.sendPageSpeedLog(f)})};a.initEventLog=function(f){f=f||window.PAGE_CONFIG.logTracker||{};GJ.use("log_tracker",function(){if(f.gjch){GJ.LogTracker.gjch=f.gjch}GJ.LogTracker.bindAllTrackEvent()})};a.sendPageViewLog=function(f){f=f||window.PAGE_CONFIG.logTracker||{};GJ.use("log_tracker",function(){GJ.LogTracker.trackPageView(f.gjch)})};a.sendPageSpeedLog=function(f){f=f||window.PAGE_CONFIG.logTracker||{};GJ.use("log_tracker",function(){GJ.LogTracker.trackSpeedEvent(f.gjch)})};a.sendGooglePvLog=function(f){f=f||"UA-479320-1";GJ.use("js/app/common/google/google.js",function(){GJ.google.trackPageview(f)})};a.userinfoWidget=c.define({init:function(f){this.config=f;this.updateWidget()},updateWidget:function(){var f=this.config;var i=GJ.getCookie("GanjiUserInfo");var h=GJ.getCookie("t3");try{i=GJ.jsonDecode(i)||{}}catch(g){i={}}var j=h?i.nickname:(GJ.jsonDecode(GJ.getCookie("GanjiUserInfo"))||{}).user_name;j=j||"";if(j){GJ.use(["app/ms_v2/widget/userinfo.js"],function(k){f.username=j;k(f)})}}});a.selfDirectionBind=function(f){GJ.use("jquery",function(g){if(g(f.$el).find(".js-lazy-load").size()){GJ.use("js/util/lazyload/jquery.lazyload.1.7.js",function(h){h(f.$el).find(".js-lazy-load").lazyload()})}});GJ.use("js/app/self_direction/direction.js",function(){GJ.app.selfDirection.bind(f)})};a.selfDirectionRender=function(f){GJ.use("js/app/self_direction/direction.js",function(){GJ.app.selfDirection.render(f)})};a.pageFromSeo=function(){var j=["http://www.baidu.com","http://www.google.com","http://www.so.com","http://www.soso.com","http://www.sogou.com"];var g=document.referrer;for(var f=0,h=j.length;f<h;f++){if(g.indexOf(j[f])>-1){return true}}return false};a.addCityDomainCookie=function(h){var i="citydomain";var g=GJ.getCookie(i);var f=31536000;if(h&&h!==g){GJ.setCookie(i,h,f);return}GJ.use("js/app/data/city_domain.js",function(l){var k={};var j=/^https?:\/\/(?:[^\.]+\.)?([^\.]+)\.(?:ganji.(?:com|cn))(?:\/([^$\/]+)(?:$|\/))?/.exec(window.location.href);GJ.each(l,function(m){k[m]=1});if(!j){return}if(j[1]&&k[j[1]]){h=j[1]}else{if(j[2]&&k[j[2]]){h=j[2]}}if(h&&h!==g){GJ.setCookie(i,h,f)}})};a.initUUID=function(){GJ.use("js/util/uuid/uuid.js",function(f){f()})};a.checkCDN=function(){GJ.use("js/util/log_tracker/check_cdn.js",function(f){f()})};a.checkNP=function(){GJ.use("js/util/log_tracker/check_np.js",function(f){f()})};a.triggerScroll=function(){var g=null;var f=d(window);f.on("scroll",function(){clearTimeout(g);g=setTimeout(function(){f.trigger("scrollEvent")},30)})};a.first=function(){a.initUUID();a.initPlaceholders();a.initWidgets()};var e=d.Deferred();a.last=function(g){a.triggerScroll();if(window.screen.width>1280){GJ.setCookie("lg",1,604800)}else{GJ.removeCookie("lg")}var f=(window.location.protocol==="https:");a.initLogTracker();if(window.PAGE_CONFIG.GOOGLE_ANA_CODE){a.sendGooglePvLog(window.PAGE_CONFIG.GOOGLE_ANA_CODE)}if(!g||!g.disableWebim){a.initWebIM()}if(GJ.rand(1,500)===1||window.location.href.indexOf("check_dnspod")){GJ.use("js/util/log_tracker/check_dnspod.js",function(h){h()})}if(!f){if(GJ.rand(1,50)===1||window.location.href.indexOf("check_cdn")!==-1){a.checkCDN()}if(window.performance&&(GJ.rand(1,10)===1||window.location.href.indexOf("check_np")!==-1)){a.checkNP()}}e.resolve();a.selfDirectionRender();setTimeout(function(){var h=false;if((GJ.ua.chrome>20||GJ.ua.ie>8)&&!f){if(GJ.rand(1,50)===10&&Object.keys&&Array.prototype.forEach){h=true}}if(window.location.search.indexOf("istargetuser")!==-1){h=true}if(h&&!GJ.config.debug){setTimeout(function(){GJ.use("js/util/md5/md5.js",function(m){var i=[];var l="http://tralog.ganji.com/sta/md5.gif?";var i=Object.keys(GJ.Module.cache).filter(function(p){return p.indexOf("guid_")===-1&&p.indexOf("http")===-1&&p.indexOf(".css")===-1&&GJ.Module.cache[p].factory});var o=i[GJ.rand(0,i.length-1)];var k=GJ.Module.cache[o].factory;var n="";if(k){n=m(k.toString().trim().replace(/^function\s*\((.*?)\)\s*{/,"function($1){"));l+="file="+o+"&md5="+n+"&dt="+new Date().getTime()}var j=new Image();j.src=l})},5000)}},3000)};a.always=function(f){e.always(f)}});
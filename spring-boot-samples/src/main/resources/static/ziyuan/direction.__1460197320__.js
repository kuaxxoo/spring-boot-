GJ.add("js/app/self_direction/direction.js",["jquery","log_tracker"],function(){GJ.app=GJ.app||{};GJ.app.selfDirection=GJ.app.selfDirection||{};GJ.app.selfDirection.bind=function(b){var a={postClass:"js_self_direction_post",attrHref:"_href",attrSign:"sign"};a=GJ.mix(a,b||{},true);$(b.$el).on("click","a",function(f){var h=b.$el.offset();var d=$(this).attr("href");if(d.indexOf("click.ganji.com")>-1){var c=parseInt(f.pageX-h.left,10);var g=parseInt(f.pageY-h.top,10);d=d.replace(/&x=.*/,"");d+="&x="+c+"&y="+g;$(this).attr("href",d)}});$("."+a.postClass+", a[sign]").filter(":not([_sd])").bind("click",function(){if(!GJ.getCookie("GanjiUserInfo")){GJ.setCookie("webimVisitorNeedComet","1",3600*24*14)}}).attr("_sd","1");if(GJ.LogTracker.gjch!=""&&GJ.LogTracker.gjch!="_"&&GJ.LogTracker.gjch!="-"){GJ.LogTracker.bindAllTrackEvent()}};GJ.app.selfDirection.render=function(a){var b={};var c=$(".js-direction-render-box");c.each(function(){if($(this).data("dxing")){return true}var d=$(this).data("boxid");var e=$(this).data("params");$(this).data("dxing",true);b["params["+d+"]"]=e});if($.isEmptyObject(b)){return true}$.post("/ajax.php?dir=self_direction&module=render",b,function(d){for(var e in d){c.filter("[data-boxid="+e+"]").html(d[e]).show()}GJ.app.selfDirection.bind();if(c.find(".js-lazy-load").size()){GJ.use("js/util/lazyload/jquery.lazyload.1.7.js",function(){c.find(".js-lazy-load").each(function(){$(this).lazyload()})})}},"json")};GJ.app.selfDirection.send=function(a){var g={after:10,befor:30000};g=GJ.mix(g,a||{},true);var c=window.location.hash,i=c.substring(c.lastIndexOf("#")+1),b=new Date().getTime(),h=false,e=false,f=function(){if(h||!e){return true}if(new Date().getTime()-b>g.after){h=true;$.getJSON("http://www.ganji.com/ajax.php?dir=self_direction&module=view_post&callback=?",{s:i},function(j){})}};GJ.LogTracker.trackEvent("/self_direction/clickJs/toShowFalse@atype=show@s="+i);if(!i){return false}var d=i.split("|");if(d.length!=2){return false}if(b-d[0]>g.befor){return false}if(typeof(d[1])=="undefined"||d[1].length<10){return false}$("body").mousemove(function(){e=true;f()});$(window).on("scrollEvent",function(){e=true;f()});window.onunload=function(){if(!h){$.getJSON("http://www.ganji.com/ajax.php?dir=self_direction&module=log")}};setTimeout(function(){f()},g.after)}});
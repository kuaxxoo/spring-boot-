GJ.add("app/common/widget/widget.js",["jquery","js/util/event/event_emitter.js"],function(c,b){var e=c("jquery");var a=c("js/util/event/event_emitter.js");var d=b;d.ready=function(g,f){g=e(g);if(!g.length){return}if(typeof g.data("widget")!=="string"){f(g.data("widget"))}else{if(g.data("widget-ready-callback-queue")){g.data("widget-ready-callback-queue").push(f)}else{g.data("widget-ready-callback-queue",[f])}}};d.initWidgets=function(){e("[data-widget]").each(function(){b.initWidget(e(this))})};d.initWidget=function(g){g=e(g);var f=g.data();f.$el=g;var h={};g.find("[data-role]").each(function(){var i=e(this).data("role");if(!h[i]){h[i]=[]}h[i].push(this)});GJ.each(h,function(j,i){f["$"+i]=e(j)});if(typeof f.widget!=="string"||g.data("_loading")){return false}GJ.each(f.widget.split(","),function(i){i=e.trim(i);var j="";if(i.indexOf("#")!==-1){i=i.split("#");j=i[1];i=i[0]}g.data("_loading",true);GJ.use(i,function(m){if(j){m=m[j]}try{m=new m(f)}catch(l){GJ.log("Widget init error:["+i+"#"+j+"]"+l.message);var k={tagName:g.get(0).tagName};e.each(g.get(0).attributes,function(){k[this.nodeName]=this.nodeValue});GJ.errorStack.push({type:"WIDGET_INIT_ERROR",message:l.message,url:i+"#"+j,$el:k});throw l}g.data("widget",m);g.data("_loading",false);if(g.data("widget-ready-callback-queue")){e.each(g.data("widget-ready-callback-queue"),function(o,n){n(m)})}})})};d.define=function(g){g=g||{};g.events=g.events||{};g.init=g.init||function(h){this.$el=e(h.$el)};e.each(g,function(h,i){if(e.isFunction(i)){g[h]=GJ.guard(i,"WIDGET")}});var f=function(i){var h=GJ.mix({},g);a.mixTo(h);if(i.$el){h.$el=e(i.$el)}h.delegateEvents=function(j){j=j||g.events;GJ.each(j,function(k,n){var l=n.indexOf(" ");var o=l===-1?n:n.substr(0,l);var m=l===-1?"":n.substr(l,n.length-1);if(typeof k==="function"){k=e.proxy(k,h)}else{k=e.proxy(h[k],h)}if(m){h.$el.on(o,m,k)}else{h.$el.on(o,k)}})};if(h.$el){h.delegateEvents()}h.init(i);return h};f.extend=function(h){h=e.extend({},g,h);h.super_=e.extend({},g);h.events=e.extend({},g.events,h.events);return d.define(h)};f.define=e.extend({},g);return f};d.template=function(h,g){var f=new Function("obj","var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj){__p.push('"+h.replace(/[\r\t\n]/g," ").split("<%").join("\t").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',$1,'").split("\t").join("');").split("%>").join("__p.push('").split("\r").join("\\'")+"');}return __p.join('');");return g?f(g):f}});